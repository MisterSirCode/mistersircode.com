<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="../Icons/ms-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="57x57" href="../Icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../Icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../Icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../Icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../Icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../Icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../Icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../Icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../Icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../Icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../Icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../Icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../Icons/favicon-16x16.png">

    <!-- Primary Meta Tags -->
    <title>SirCodes Game</title>
    <meta name="title" content="Mister SirCodes Homepage">
    <meta name="description" content="Main website for my Projects and Portfolio">
    <meta name="theme-color" content="#ffffff">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Mister SirCodes Homepage">
    <meta property="og:description" content="Main website for my Projects and Portfolio">
    <meta property="og:image" content="https://mistersircode.com/Images/SCLOGOSmall.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Mister SirCodes Homepage">
    <meta property="twitter:description" content="Main website for my Projects and Portfolio">
    <meta property="twitter:image" content="https://mistersircode.com/Images/SCLOGOSmall.png">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="../Stylesheets/index.css">
    <style>
        * {
            box-sizing: border-box;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        body {
            overflow-x: hidden;
            background: black;
        }

        .container-fluid {
            padding: 0 !important;
        }

        canvas {
            margin-left: 25%;
        }
    </style>
</head>

<body>
    <canvas class="gameCanvas"></canvas>
</body>
<script>
    const cvs = document.querySelector(".gameCanvas");
    const ctx = cvs.getContext("2d");

    let gameState = "start";
    let switchingToGame = false;
    let switchingFromStart = false;
    let playGameAlpha = 1;
    let ingameAlpha = 0;
    let currentGroundPos = [0, 0, 0];
    let currentSkyPos = [0, 0, 0];
    let groundSize = 0;
    let skySize = 0;
    let moveSpeed = 7;
    let skyMoveSpeed = moveSpeed / 8;
    let gameStartTimer = 3;
    let playerY = 0;
    let goToPlayerY = 0;
    let obstacles = [];
    let currentPos = 0;
    let groundBlocks = [];
    let immortal = false;

    const groundImage = new Image();
    groundImage.src = "../Images/noiseGradientGround.png";
    const skyImage = new Image();
    skyImage.src = "../Images/noiseGradientSky.png";
    const playerImage = new Image();
    playerImage.src = "../Images/playerCharacter.png";
    const obstImage = new Image();
    obstImage.src = "../Images/obstacle.png";

    function getMouseLocation(e) {
        let rect = cvs.getBoundingClientRect(),
            scaleX = cvs.width / rect.width,
            scaleY = cvs.height / rect.height;
        return {
            x: ((e.clientX - rect.left) * scaleX) - 2,
            y: ((e.clientY - rect.top) * scaleY) - 2
        };
    }

    function centerRect(x, y, w, h) {
        ctx.fillRect(x - (w / 2), y - (h / 2), w, h);
    }

    function mouseInCenterRect(mx, my, x, y, w, h) {
        return mx >= x - (w / 2) && mx <= x - (w / 2) + w && my >= y - (h / 2) && my <= y - (h / 2) + h;
    }

    function mouseInRect(mx, my, x, y, w, h) {
        return mx >= x && mx <= x + w && my >= y && my <= y + h;
    }

    function init() {
        cvs.width = window.innerHeight;
        cvs.height = window.innerHeight;
        groundSize = cvs.width / 3;
        for (var i = 0; i < 4; i++) {
            currentGroundPos[i] = i * groundSize;
        }
        skySize = cvs.width / 1.5;
        for (var i = 0; i < 4; i++) {
            currentSkyPos[i] = i * skySize;
        }
        update();
        document.body.addEventListener("click", (e) => {
            const m = getMouseLocation(e);
            if (gameState == "start") {
                if (mouseInCenterRect(m.x, m.y, cvs.width / 2 - 2, cvs.height / 2, 256, 128)) {
                    switchingToGame = true;
                    setTimeout(() => {
                        gameState = "game";
                        playGameAlpha = 0;
                        switchingToGame = false;
                        switchingFromStart = true;
                    }, 1000);
                    setTimeout(() => {
                        switchingFromStart = false;
                        ingameAlpha = 1;
                    }, 2000);
                }
            } else {

            }
        });
    }

    window.addEventListener("resize", () => {
        cvs.width = window.innerHeight;
        cvs.height = window.innerHeight;
    });

    function update() {
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, cvs.width, cvs.height);
        drawEnvironment();
        drawObstacles();
        drawPlayer();
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, cvs.width, 50);
        ctx.fillStyle = `rgba(255, 255, 255, ${ingameAlpha})`;
        const mg = 20;
        ctx.fillRect(0, 0, cvs.width, mg);
        ctx.fillRect(0, 50, cvs.width, mg);
        ctx.fillRect(0, cvs.height - mg, cvs.width, mg);
        ctx.fillRect(0, 0, mg, cvs.height);
        ctx.fillRect(cvs.width - mg, 0, mg, cvs.height);
        window.requestAnimationFrame(update);
    }

    function drawEnvironment() {
        if (switchingToGame) playGameAlpha -= 0.1;
        if (switchingFromStart) ingameAlpha += 0.1;
        if (gameState == "start") {
            ctx.fillStyle = `rgba(255, 255, 255, ${playGameAlpha})`;
            centerRect(cvs.width / 2, cvs.height / 2, 256, 128);
            ctx.textAlign = "center";
            ctx.fillStyle = "#000";
            ctx.font = "75px Courier monospace";
            ctx.fillText("PLAY", cvs.width / 2, cvs.height / 2 + 25);
        } else if (gameState == "game") {
            ctx.save();
            ctx.imageSmoothingEnabled = false;
            currentPos = groundSize;
            currentPos -= moveSpeed;
            if (currentPos <= 0) {
                groundBlocks.push([cvs.width, cvs.height - groundSize]);
                currentPos = groundSize;
            }
            groundBlocks.forEach((e) => {
                ctx.drawImage(groundImage, e[0], e[1], groundSize, groundSize);
                e[0] -= moveSpeed;
            });
            for (var i = 0; i < 4; i++) {
                if (currentSkyPos[i] <= -skySize) currentSkyPos[i] = 3 * skySize;
                ctx.drawImage(skyImage, currentSkyPos[i], cvs.height - groundSize - skySize, skySize, skySize);
            }
            ctx.restore();
        }
    }

    document.addEventListener("keydown", (e) => {
        if (gameState == "game") {
            if (playerY === 0 && e.key === " ") {
                goToPlayerY = 128;
            }
        }
    });

    function drawObstacles() {
        if (gameState == "game") {
            const chance = Math.random() * 100;
            if (chance > 99.4) {
                obstacles.push([groundSize * 3, (cvs.height - groundSize - 32)]);
            }
            obstacles.forEach((e) => {
                console.log(e[0]);
                e[0] -= moveSpeed;
                ctx.drawImage(obstImage, e[0], e[1], 32, 32);
                ctx.fillStyle = "rgba(255, 0, 0, 0.6)";
                if (location.hash === "#debug" || location.hash === "debug") 
                    ctx.fillRect(e[0], e[1], 32, 32);
                if (e[0] <= -64) obstacles.shift();
                if (playerY >= -10 && playerY < 32 && e[0] <= 290 && e[0] >= 270 && immortal === false) {
                    switchingToGame = false;
                    switchingFromStart = false;
                    gameState = "start";
                    playGameAlpha = 1;
                    ingameAlpha = 0;
                    obstacles = [];
                    playerY = 0;
                    goToPlayerY = 0;
                }
                ctx.fillStyle = "rgba(255, 0, 0, 0.6)";
                if (location.hash === "#debug" || location.hash === "debug") 
                    ctx.fillRect(270, (cvs.height - groundSize - 64) + 10, 20, 42);
            });
        }
    }

    function drawPlayer() {
        if (gameState == "game") {
            ctx.save();
            ctx.imageSmoothingEnabled = false;
            if (playerY < goToPlayerY) playerY += 8;
            if (playerY > goToPlayerY) playerY -= 8;
            if (playerY >= 128) goToPlayerY = 0;
            ctx.fillStyle = "rgba(0, 255, 0, 0.6)";
            if (location.hash === "#debug" || location.hash === "debug") 
                ctx.fillRect(256, (cvs.height - groundSize - 64) - playerY, 64, 64);
            ctx.drawImage(playerImage, 256, (cvs.height - groundSize - 64) - playerY, 64, 64);
            ctx.restore();
        }
    }

    groundImage.onload = function () {
        init();
    }
</script>

</html>
